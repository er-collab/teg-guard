<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEG 3.2.2 - บัตรพนักงานภายนอก</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');

* { box-sizing: border-box; }
body {
  font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  background-image: url('https://img2.pic.in.th/pic/29a2bfcf779db2329.jpg');
  background-size: cover;
  background-position: center;
  background-attachment: fixed;
  min-height: 100vh;
  padding: 15px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  color: #2c3e50;
}

.lang-switcher {
  position: absolute;
  top: 20px;
  right: 20px;
  display: flex;
  gap: 8px;
  z-index: 1000;
}
.lang-btn {
  width: 44px;
  height: 44px;
  border: 2px solid rgba(255,255,255,0.3);
  border-radius: 12px;
  background: rgba(255,255,255,0.9);
  color: #374151;
  font-weight: 600;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.2s ease;
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
}
.lang-btn.active {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  border-color: #3b82f6;
  box-shadow: 0 4px 15px rgba(59,130,246,0.3);
}
.lang-btn:hover { transform: scale(1.05); }

.container {
  background: rgba(255, 255, 255, 0.92);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 24px;
  padding: 28px 24px;
  width: 100%;
  max-width: 420px;
  max-height: 95vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
  position: relative;
  margin-top: 80px;
}

h1 {
  text-align: center;
  color: #1a1a1a;
  font-weight: 600;
  font-size: clamp(1.4rem, 4vw, 1.6rem);
  margin: 0 0 20px 0;
  letter-spacing: 0.5px;
}

.form-section, .card-section { display: flex; flex-direction: column; gap: 20px; }

.form-group { display: flex; flex-direction: column; gap: 8px; }
label { font-weight: 500; color: #374151; font-size: 0.95rem; letter-spacing: 0.3px; }
select, input[type="text"], input[type="file"] {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  background: rgba(255, 255, 255, 0.8);
  font-family: inherit;
  font-size: 1rem;
  color: #1f2937;
  font-weight: 400;
  transition: all 0.2s ease;
  backdrop-filter: blur(10px);
}
select option { font-family: inherit; }
input:focus, select:focus {
  outline: none;
  border-color: #3b82f6;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}
input[type="file"]::file-selector-button {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 8px;
  font-weight: 500;
  cursor: pointer;
  margin-right: 12px;
  transition: all 0.2s;
}
input[type="file"]::file-selector-button:hover {
  background: linear-gradient(135deg, #1d4ed8, #1e40af);
  transform: translateY(-1px);
}

.pdpa-notice {
  background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
  border: 1px solid #f59e0b;
  border-radius: 12px;
  padding: 16px;
  margin: 20px 0;
  font-size: 0.85rem;
  line-height: 1.5;
  color: #92400e;
}
.pdpa-notice h4 { color: #b45309; margin: 0 0 8px 0; font-weight: 600; font-size: 0.95rem; }
.pdpa-checkbox {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  margin-top: 12px;
}
.pdpa-checkbox input[type="checkbox"] {
  width: auto;
  margin: 2px 0 0 0;
  transform: scale(1.2);
}

.main-button {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  font-size: 1.05rem;
  cursor: pointer;
  transition: all 0.2s ease;
  letter-spacing: 0.5px;
}
.generate-button {
  background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
  color: white;
  box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}
.generate-button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 12px 35px rgba(59, 130, 246, 0.5);
}
.generate-button:disabled {
  background: #9ca3af;
  cursor: not-allowed;
  transform: none;
}

#preview1 {
  width: 100px;
  height: 130px;
  object-fit: cover;
  border-radius: 10px;
  border: 2px solid #e5e7eb;
  margin-top: 8px;
  display: none;
}

.employee-card {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 20px;
  padding: 0;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.4);
  overflow: hidden;
  backdrop-filter: blur(10px);
}

.card-header {
  background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  padding: 24px 28px 20px;
  text-align: center;
  border-bottom: 1px solid rgba(226, 232, 240, 0.8);
}
.card-company {
  font-weight: 600;
  font-size: 1.1rem;
  color: #1e293b;
  margin: 0 0 4px 0;
}
.card-subtitle {
  font-size: 0.85rem;
  color: #64748b;
  font-weight: 400;
  margin: 0;
}

.card-body {
  padding: 28px;
  display: flex;
  gap: 20px;
}
.card-photo {
  width: 100px;
  height: 130px;
  border-radius: 14px;
  object-fit: cover;
  flex-shrink: 0;
  border: 3px solid rgba(255, 255, 255, 0.8);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}
.card-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.detail-row { display: flex; align-items: flex-start; gap: 12px; }
.detail-label {
  font-weight: 600;
  font-size: 0.9rem;
  color: #374151;
  min-width: 55px;
  flex-shrink: 0;
}
.detail-value {
  font-weight: 500;
  font-size: 1rem;
  color: #1f2937;
  flex: 1;
}

.qr-container {
  margin-top: 24px;
  padding: 24px;
  background: rgba(255, 255, 255, 0.98);
  border-radius: 20px;
  border: 1px solid rgba(226, 232, 240, 0.8);
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  text-align: center;
}
.qr-title {
  font-weight: 600;
  font-size: 1.05rem;
  color: #1f2937;
  margin-bottom: 16px;
  letter-spacing: 0.3px;
}
#qr-canvas {
  width: 240px;
  height: 240px;
  border: 3px solid #f3f4f6;
  border-radius: 16px;
  background: white;
  box-shadow: 0 10px 35px rgba(0, 0, 0, 0.15);
  margin: 0 auto 16px;
}
.qr-hint { font-size: 0.9rem; color: #6b7280; line-height: 1.5; }

.status-info {
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
  border: 1px solid #a7f3d0;
  border-radius: 12px;
  padding: 16px;
  margin-top: 20px;
  text-align: center;
}
.status-info h3 { color: #166534; font-size: 1.1rem; font-weight: 600; margin: 0 0 8px 0; }
.status-info p { color: #047857; margin: 0; font-size: 0.95rem; }

@media (max-width: 480px) {
  .container { padding: 20px 16px; margin-top: 100px; }
  .card-body { flex-direction: column; gap: 16px; }
  .card-photo { width: 100%; height: 120px; align-self: center; }
  #qr-canvas { width: 220px; height: 220px; }
}
</style>
</head>
<body>
<div class="lang-switcher">
  <button class="lang-btn active" data-lang="th">ไทย</button>
  <button class="lang-btn" data-lang="mm">မြန်မာ</button>
  <button class="lang-btn" data-lang="km">ខ្មែរ</button>
</div>
<div class="container" id="main-container"></div>

<script>
const translations = {
  th: {
    title: "ขออนุญาตออกนอกพื้นที่",
    subtitle: "กรณี 3.2.2 - พนักงานพักอาศัยภายนอก",
    name: "ชื่อ-นามสกุล",
    code: "รหัสพนักงาน",
    company: "บริษัท",
    dept: "แผนก",
    photo: "รูปถ่ายพนักงาน",
    generate: "สร้างบัตรพนักงาน",
    pdpa_title: "PDPA - นโยบายความเป็นส่วนตัว",
    pdpa_text: `บริษัทในฐานะผู้ควบคุมข้อมูลส่วนบุคคล จะเก็บรวบรวม ใช้ และประมวลผลข้อมูลส่วนบุคคลของท่าน ได้แก่ ชื่อ–สกุล รหัสพนักงาน รูปถ่าย<br>
เพื่อวัตถุประสงค์ในการตรวจสอบสิทธิ์ ดูแลความปลอดภัย และบริหารจัดการการเข้า–ออกตามมาตรการของบริษัทเท่านั้น<br><br>
การกดปุ่ม "สร้าง QR Code" ถือว่าท่านได้อ่าน รับทราบ และ ให้ความยินยอม ตามพระราชบัญญัติคุ้มครองข้อมูลส่วนบุคคล พ.ศ. 2562`,
    consent: "ฉันยอมรับและให้ความยินยอมตาม PDPA",
    card_subtitle: "กรณี 3.2.2 - พนักงานพักอาศัยภายนอก",
    name_label: "ชื่อ",
    code_label: "รหัส",
    dept_label: "แผนก",
    company_label: "บริษัท",
    qr_title: "QR Code สำหรับการตรวจสอบ",
    qr_hint: "แสดงต่อเจ้าหน้าที่รักษาความปลอดภัย<br><strong>ข้อมูลครบถ้วนถาวร</strong>",
    status_title: "✅ บัตรพร้อมใช้งาน",
    status_text: "พิมพ์หรือบันทึกหน้าจอเพื่อแสดงต่อ รปภ.",
    new_card: "สร้างบัตรใหม่"
  },
  mm: {
    title: "စက်ရုံပြင်ပ ထွက်ခွင့်တောင်း",
    subtitle: "အခြေအနေ 3.2.2 - ပြင်ပနေထိုင်သူ ဝန်ထမ်း",
    name: "အမည်",
    code: "ဝန်ထမ်းနံပါတ်",
    company: "ကုမ္ပဏီ",
    dept: "ဌာန",
    photo: "ဓာပုံ",
    generate: "ကတ်ဖန်တီး",
    pdpa_title: "PDPA - ပုဂ္ဂလ်ရေးကိုယ်ရေးအချက်အလက်",
    pdpa_text: `ကုမ္ပဏီသည် ကိုယ်ရေးအချက်အလက်ထိန်းချုပ်သူအဖြစ် သင်၏ ကိုယ်ရေးအချက်အလက်များကို စုဆောင်း၊ အသုံးပြု၊ လုပ်ဆောင်မည် အမည်၊ ဝန်ထမ်းနံပါတ်၊ ဓာပုံ<br>
သင့်ခွင့်ပြုချက်စစ်ဆေး၊ လုံခြုံရေး စီမံခန့်ခွဲရန်နှင့် ကုမ္ပဏီ စည်းမျဉ်းများအတိုင်း ဝင်ရောက်စီမံရန်သာ ရည်ရွယ်သည်<br><br>
"QR Code ထုတ်လုပ်ရန်" ခလုတ်နှိပ်ခြင်းဖြင့် သင်သည် PDPA ဥပဒေအရ နားလည်ပြီး ခွင့်ပြုချက်ပေးသည်`,
    consent: "PDPA အရ လက်ခံပြီး ခွင့်ပြုချက်ပေး",
    card_subtitle: "အခြေအနေ 3.2.2 - ပြင်ပနေထိုင်သူ",
    name_label: "အမည်",
    code_label: "နံပါတ်",
    dept_label: "ဌာန",
    company_label: "ကုမ္ပဏီ",
    qr_title: "စစ်ဆေးရန် QR Code",
    qr_hint: "လုံခြုံရေးဝန်ထမ်းထံ ပြပါ<br><strong>အချက်အလက်ပြည့်စုံသည်</strong>",
    status_title: "✅ ကတ်အသုံးပြုရန်အဆင်သင့်",
    status_text: "ပရင့်လုပ် သို့မဟုတ် မျက်နှာပြင်သိမ်းပါ",
    new_card: "ကတ်အသစ်ဖန်တီး"
  },
  km: {
    title: "ស្នើសុំចាប់អារម្មណ៍ចេញក្រៅតំបន់",
    subtitle: "ករណី 3.2.2 - បុគ្គលិករស់នៅខាងក្រៅ",
    name: "ឈ្មោះ-នាម",
    code: "កូដបុគ្គលិក",
    company: "ក្រុមហ៊ុន",
    dept: "នាយកដ្ឋាន",
    photo: "រូបថត",
    generate: "បង្កើតកាត",
    pdpa_title: "PDPA - គោលនយោបាយឯកជនភាព",
    pdpa_text: `ក្រុមហ៊ុនក្នុងនាមជាអ្នកគ្រប់គ្រងទិន្នន័យផ្ទាល់ខ្លួន នឹងប្រមូล ប្រើប្រាស់ និងដំណើរការទិន្នន័យផ្ទាល់ខ្លួនរបស់អ្នក រួមមាន ឈ្មោះ កូដបុគ្គលិក រូបថត<br>
សម្រាប់គោលបំណងត្រួតពិនិត្យសិទ្ធិ គ្រប់គ្រងសុវត្ថិភាព និងគ្រប់គ្រងការចូល-ចេញតាមវិធានការក្រុមហ៊ុនតែប៉ុណ្ណោះ<br><br>
ការចុចប៊ូតុង "បង្កើត QR Code" ត្រូវបានចាត់ទុកថាអ្នកបានអានយល់ដឹង និងយល់ព្រមតាមច្បាប់ការពារទិន្នន័យផ្ទាល់ខ្លួន ឆ្នាំ២០២២`,
    consent: "ខ្ញុំយល់ព្រមនិងផ្តល់ការយល់ព្រមតាម PDPA",
    card_subtitle: "ករណី 3.2.2 - បុគ្គលិករស់នៅខាងក្រៅ",
    name_label: "ឈ្មោះ",
    code_label: "កូដ",
    dept_label: "នាយកដ្ឋាន",
    company_label: "ក្រុមហ៊ុន",
    qr_title: "QR Code សម្រាប់ត្រួតពិនិត្យ",
    qr_hint: "បង្ហាញដល់មន្ត្រីសុវត្ថិភាព<br><strong>ព័ត៌មានពេញលេញនិរន្តរភាព</strong>",
    status_title: "✅ កាតត្រៀមរួចសម្រាប់ប្រើប្រាស់",
    status_text: "បោះពុម្ពឬរក្សាទុកអេក្រង់ដើម្បីបង្ហាញដល់ សៀមហ្វុង",
    new_card: "បង្កើតកាតថ្មី"
  }
};

const companies = [
  "บริษัท อี.คิว. รับเบอร์ จำกัด (EQO)",
  "บริษัท ไทยอีสเทิร์น อินโนเวชั่น จำกัด (TEI)",
  "บริษัท ไทยอีสเทิร์น รับเบอร์ จำกัด (TER)",
  "บริษัท อีสเทิร์น ปาล์ม ออยล์ จำกัด (EPO)",
  "บริษัท ไทยอีสเทิร์น ท้อปซีดส์ ออยล์ จำกัด (TETSO)",
  "บริษัท ไทยอีสเทิร์น ไบโอ พาวเวอร์ จำกัด (มหาชน) (TEBP)",
  "บริษัท ไทยอีสเทิร์น โลจิสติกส์ จำกัด (TEL)",
  "บริษัท ไทยอีสเทิร์น อินดัสเตรียล แลนด์ จำกัด (TEIL)"
];

let currentLang = 'th';

document.addEventListener('DOMContentLoaded', function() {
  setupLanguageSwitcher();
  showForm(document.getElementById('main-container'));
});

function setupLanguageSwitcher() {
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      currentLang = this.dataset.lang;
      document.querySelector('.lang-btn.active').classList.remove('active');
      this.classList.add('active');
      showForm(document.getElementById('main-container'));
    });
  });
}

function showForm(container) {
  const t = translations[currentLang];
  container.innerHTML = `
    <h1>${t.title}</h1>
    <p style="text-align:center;color:#6b7280;font-size:0.95rem;margin-bottom:24px;">${t.subtitle}</p>
    
    <form id="form1" class="form-section">
      <div class="form-group">
        <label>${t.name}</label>
        <input type="text" id="name1" required placeholder="กรุณากรอกชื่อ-นามสกุล">
      </div>
      <div class="form-group">
        <label>${t.code}</label>
        <input type="text" id="code1" required placeholder="กรุณากรอกรหัสพนักงาน">
      </div>
      <div class="form-group">
        <label>${t.company}</label>
        <select id="company1" required>
          <option value="">-- เลือกบริษัท --</option>
          ${companies.map(c => `<option value="${c}">${c}</option>`).join('')}
        </select>
      </div>
      <div class="form-group">
        <label>${t.dept}</label>
        <input type="text" id="dept1" required placeholder="กรุณากรอกแผนก">
      </div>
      
      <div class="pdpa-notice">
        <h4>${t.pdpa_title}</h4>
        <div>${t.pdpa_text}</div>
        <label class="pdpa-checkbox">
          <input type="checkbox" id="pdpa-consent">
          <span>${t.consent}</span>
        </label>
      </div>
      
      <div class="form-group">
        <label>${t.photo}</label>
        <input type="file" id="photo1" accept="image/*" capture="user">
        <img id="preview1" style="display:none;">
      </div>
      <button type="submit" class="main-button generate-button" id="generateBtn" disabled>${t.generate}</button>
    </form>
  `;
  
  // Photo preview
  document.getElementById('photo1').addEventListener('change', function(e) {
    const file = e.target.files[0];
    const preview = document.getElementById('preview1');
    const btn = document.getElementById('generateBtn');
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        preview.src = e.target.result;
        preview.style.display = 'block';
        checkFormReady();
      };
      reader.readAsDataURL(file);
    } else {
      preview.style.display = 'none';
      checkFormReady();
    }
  });
  
  // Form submit
  document.getElementById('form1').addEventListener('submit', function(e) {
    e.preventDefault();
    createProfessionalCard();
  });
  
  // Check form ready
  function checkFormReady() {
    const name = document.getElementById('name1').value.trim();
    const code = document.getElementById('code1').value.trim();
    const company = document.getElementById('company1').value;
    const dept = document.getElementById('dept1').value.trim();
    const pdpa = document.getElementById('pdpa-consent').checked;
    const photo = document.getElementById('photo1').files.length > 0;
    
    const btn = document.getElementById('generateBtn');
    btn.disabled = !(name && code && company && dept && pdpa && photo);
  }
  
  // Watch all inputs
  document.getElementById('name1').addEventListener('input', checkFormReady);
  document.getElementById('code1').addEventListener('input', checkFormReady);
  document.getElementById('company1').addEventListener('change', checkFormReady);
  document.getElementById('dept1').addEventListener('input', checkFormReady);
  document.getElementById('pdpa-consent').addEventListener('change', checkFormReady);
}

function createProfessionalCard() {
  const name = document.getElementById('name1').value;
  const code = document.getElementById('code1').value;
  const company = document.getElementById('company1').value;
  const dept = document.getElementById('dept1').value;
  const file = document.getElementById('photo1').files[0];
  const t = translations[currentLang];
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const photoData = e.target.result;
    const key = 'EMP_' + Date.now();
    showEmployeeCard(name, code, company, dept, photoData, key, t);
  };
  reader.readAsDataURL(file);
}

function showEmployeeCard(name, code, company, dept, photoData, key, t) {
  const container = document.getElementById('main-container');
  container.innerHTML = `
    <div class="card-section">
      <div class="employee-card">
        <div class="card-header">
          <h3 class="card-company">${company}</h3>
          <p class="card-subtitle">${t.card_subtitle}</p>
        </div>
        
        <div class="card-body">
          <img src="${photoData}" class="card-photo" alt="รูปพนักงาน">
          <div class="card-details">
            <div class="detail-row">
              <span class="detail-label">${t.name_label}</span>
              <span class="detail-value">${name}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">${t.code_label}</span>
              <span class="detail-value">${code}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">${t.dept_label}</span>
              <span class="detail-value">${dept}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">${t.company_label}</span>
              <span class="detail-value">${company}</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="qr-container">
        <div class="qr-title">${t.qr_title}</div>
        <canvas id="qr-canvas"></canvas>
        <div class="qr-hint">${t.qr_hint}</div>
      </div>
      
      <div class="status-info">
        <h3>${t.status_title}</h3>
        <p>${t.status_text}</p>
      </div>
      
      <button class="main-button" onclick="location.reload()" style="background:#6b7280;">${t.new_card}</button>
    </div>
  `;
  
  // Generate QR Code
  setTimeout(() => {
    try {
      const canvas = document.getElementById('qr-canvas');
      const qrUrl = `${window.location.origin}${window.location.pathname}?key=${key}`;
      new QRious({
        element: canvas,
        value: qrUrl,
        size: 240,
        level: 'H'
      });
    } catch (error) {
      console.error('QR Error:', error);
      document.getElementById('qr-canvas').innerHTML = 'QR Code Error';
    }
  }, 100);
}
</script>
</body>
</html>
